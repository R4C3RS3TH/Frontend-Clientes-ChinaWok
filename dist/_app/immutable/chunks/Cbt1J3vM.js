class s{static instance;socket=null;url="";reconnectInterval=5e3;listeners=[];isConnected=!1;constructor(){}static getInstance(){return s.instance||(s.instance=new s),s.instance}connect(e){if(this.url=e,this.socket&&(this.socket.readyState===WebSocket.OPEN||this.socket.readyState===WebSocket.CONNECTING)){console.log("WebSocket is already connected or connecting.");return}console.log(`Connecting to WebSocket at ${this.url}...`),this.socket=new WebSocket(this.url),this.socket.onopen=()=>{console.log("WebSocket connected."),this.isConnected=!0},this.socket.onmessage=t=>{try{const o=JSON.parse(t.data);this.listeners.forEach(n=>{try{n(o)}catch(c){console.error("Error in WebSocket listener:",c)}})}catch(o){console.error("Error parsing WebSocket message:",o)}},this.socket.onclose=()=>{console.log("WebSocket disconnected. Reconnecting in 5 seconds..."),this.isConnected=!1,setTimeout(()=>this.connect(this.url),this.reconnectInterval)},this.socket.onerror=t=>{console.error("WebSocket error:",t),this.socket?.close()}}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(t=>t!==e)}setMessageHandler(e){this.addListener(e)}send(e){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify(e)):console.warn("WebSocket is not open. Cannot send message.")}close(){this.socket&&(this.socket.close(),this.socket=null)}}export{s as W};
