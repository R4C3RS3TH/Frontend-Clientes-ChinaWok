import{g as f}from"./5_Mw-njR.js";import{b as p,i as w,u,o as h,p as m,t as l}from"./6jeJ50EK.js";class c extends Error{}c.prototype.name="InvalidTokenError";function v(e){return decodeURIComponent(atob(e).replace(/(.)/g,(t,o)=>{let r=o.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function b(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return v(t)}catch{return atob(t)}}function T(e,t){if(typeof e!="string")throw new c("Invalid token specified: must be a string");t||(t={});const o=t.header===!0?0:1,r=e.split(".")[o];if(typeof r!="string")throw new c(`Invalid token specified: missing part #${o+1}`);let i;try{i=b(r)}catch(n){throw new c(`Invalid token specified: invalid base64 for part #${o+1} (${n.message})`)}try{return JSON.parse(i)}catch(n){throw new c(`Invalid token specified: invalid json for part #${o+1} (${n.message})`)}}const g={products_store:m,orders_store:h,user_profile:u,session_store:u,inventory_store:w},D=e=>{console.log("Received notification:",e),p.set(!1);const t=e.ui||e.Detail&&e.Detail.ui,o=e.data||e.Detail&&e.Detail.data;if(!t){console.warn("Invalid notification payload (missing ui):",e);return}const{action:r,variant:i,message:n,target:s}=t;switch(r){case"SHOW_TOAST":l.set({message:n||"Notification received",type:i?i.toLowerCase():"info"}),setTimeout(()=>l.set(null),3e3);break;case"REDIRECT":o&&o.redirectUrl?f(o.redirectUrl):console.warn("REDIRECT action received but no redirectUrl found in data.");break;case"HYDRATE":if(s&&g[s]){let a=o.items||o;if((s==="session_store"||s==="user_profile")&&a.idToken)try{const d=T(a.idToken);console.log("Decoded JWT:",d),a={...a,...d}}catch(d){console.error("Failed to decode JWT:",d)}g[s].set(a),console.log(`Hydrated store: ${s}`),(s==="session_store"||s==="user_profile")&&(l.set({message:"¡Inicio de sesión exitoso!",type:"success"}),setTimeout(()=>l.set(null),3e3),f("/"))}else console.warn(`HYDRATE action received for unknown target: ${s}`);break;case"REFRESH_DATA":console.log("REFRESH_DATA requested. Invalidate relevant data.");break;case"SILENT":console.log("Heartbeat/Silent message received:",n);break;default:console.warn(`Unknown action: ${r}`)}};export{D as h};
