import{W as d}from"./Cbt1J3vM.js";import{i as r}from"./6jeJ50EK.js";class i{static instance;wsService;isInitialized=!1;constructor(){this.wsService=d.getInstance()}static getInstance(){return i.instance||(i.instance=new i),i.instance}initialize(){if(this.isInitialized){console.log("Inventory service already initialized");return}this.wsService.setMessageHandler(s=>{this.handleInventoryMessage(s)}),this.isInitialized=!0,console.log("Inventory service initialized")}requestInventory(s="PLATO",n=20){const t={action:"Productos.Listar",data:{productType:s,limit:n}};if(!this.wsService.socket||this.wsService.socket.readyState!==WebSocket.OPEN){console.log("WebSocket not ready, retrying inventory request in 1s..."),setTimeout(()=>this.requestInventory(s,n),1e3);return}console.log("Requesting inventory:",t),this.wsService.send(t)}handleInventoryMessage(s){console.log("Inventory message received:",s);const n=s.data||s.Detail&&s.Detail.data;if(n&&n.products){const t=n.products,o={};t.length>0&&console.log("First product structure:",JSON.stringify(t[0],null,2)),t.forEach(e=>{const c=e.pk?.S||e.pk||e.tenant_id?.S||e.tenant_id||e.tenantId||e.PK?.S||e.PK||"unknown_pk",a=e.sk?.S||e.sk||e.producto_id?.S||e.producto_id||e.sku||e.SK?.S||e.SK||"unknown_sk",l=`${c}_${a}`;o[l]=e}),r.update(e=>({...e,...o})),console.log(`Inventory updated with ${t.length} items`)}}getStock(s,n){const t=`${s}_${n}`;let o=null;return r.subscribe(e=>{e[t]&&e[t].stock&&(o=parseInt(e[t].stock.N))})(),o}}export{i as I};
